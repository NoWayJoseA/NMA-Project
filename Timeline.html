<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NMA Timeline</title>
  <link rel="icon" href="/assets/nma-favicon.png" />

  <!--
    Shared styling with the search page so everything feels like one site.
    Keeping the same color choices on purpose.
  -->
  <style>
    :root {
      --brand-teal: #5b8f8e;      /* main NMA teal */
      --cta: #C0E6E6;             /* buttons / highlight */
      --border: #e6ecec;          /* soft border for cards */
      --chip-bg: #f3f7f7;         /* light background for small UI bits */
    }

    /* Overall page and text setup */
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      background: #fff;
      color: #111;
    }
    .page {
      padding: 1.5rem;
      max-width: 1100px;
      margin: auto;
    }

    /* Big timeline title */
    h1 {
      text-align: center;
      color: var(--brand-teal);
      font-size: 2.3rem;
      font-weight: 800;
      margin-bottom: 0.5rem;
    }

    /* Short intro under title */
    .lead {
      color: #6b7a7a;
      max-width: 60ch;
      margin: 0 auto 24px;
      font-size: 1.05rem;
      font-weight: 500;
      text-align: center;
    }

    /* Shared section title style */
    .section-heading {
      color: var(--brand-teal);
      font-size: 1.8rem;
      font-weight: 800;
      text-align: center;
      margin-bottom: 0.3rem;
    }

    /* Descriptions under section titles */
    .section-lead {
      color: #555;
      max-width: 70ch;
      margin: 0 auto 1rem;
      font-size: 1.05rem;
      font-weight: 500;
      text-align: center;
    }

    /* Thick horizontal divider between big chunks */
    .section-divider {
      border-top: 5px solid var(--brand-teal);
      margin: 2rem 0;
    }

    /* Frame around the KnightLab timeline embed */
    .timeline-frame {
      border: 4px solid var(--cta);
      border-radius: 14px;
      padding: 1.3rem;
      background: #f9ffff;
    }
    .timeline-frame header h2 {
      color: var(--brand-teal);
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.4rem;
      text-align: center;
    }
    .timeline-frame header p {
      max-width: 70ch;
      margin: 0.3rem auto 1rem;
      color: #555;
      text-align: center;
      font-size: 1rem;
    }

    /* Container for the CSV-driven list view version */
    .timeline-list-section {
      border: 4px solid var(--cta);
      border-radius: 14px;
      padding: 1.2rem;
      background: #ffffff;
    }

    /* Little nav row for the vertical swipe box (back to top/bottom) */
    .scroll-nav {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: flex-end;
      margin: 0.5rem 0;
    }
    .scroll-nav button {
      background: var(--cta);
      border: 2px solid var(--brand-teal);
      padding: 0.35rem 0.7rem;
      border-radius: 999px;
      font-size: 0.85rem;
      cursor: pointer;
    }

    /* This is the vertical swipe box so users don't scroll forever down the page */
    .scroll-box {
      max-height: 60vh;      /* vertical limit; still feels ok on desktop */
      overflow-y: auto;      /* only vertical scrolling, no weird side scroll */
      padding-right: 0.25rem;
    }

    /* UL wrapper for event cards */
    .timeline-list {
      padding: 0;
      list-style: none;
      margin: 1rem 0 0;
    }

    /* Each event = card */
    .timeline-card {
      border: 5px solid var(--border);
      border-left: 5px solid var(--brand-teal);
      border-radius: 10px;
      padding: 1rem;
      background: #fff;
      margin-bottom: 1rem;
    }

    /* Date at top of each card */
    .timeline-card-date {
      margin: 0 0 0.4rem;
      font-size: 0.95rem;
      font-weight: 600;
      color: #555;
    }

    /* Headline of the event */
    .timeline-card-title {
      margin: 0 0 0.35rem;
      font-size: 1.1rem;
      font-weight: 700;
      color: #123;
    }

    /* Main description/content */
    .timeline-card-text {
      margin: 0;
      color: #444;
      line-height: 1.5;
    }

    /* Link row for "open related doc/event" */
    .timeline-card-link {
      margin-top: 0.45rem;
      font-size: 0.9rem;
    }
    .timeline-card-link a {
      color: var(--brand-teal);
      text-decoration: underline;
    }

    /* Fallback message for empty/failed CSV */
    .muted {
      text-align: center;
      color: #777;
      font-size: 0.95rem;
      margin-top: 1rem;
    }

    /* Mobile tweaks */
    @media (max-width: 600px) {
      .section-heading { text-align: left; }
      .section-lead { text-align: left; }
      .timeline-frame header h2 { text-align: left; }
      .timeline-frame header p { text-align: left; }

      /* Give timeline list more height on phones */
      .scroll-box {
        max-height: 70vh;
      }
    }
  </style>
</head>

<body>
  <main class="page">

    <!-- Page intro -->
    <h1>NMA Historical Timeline</h1>
    <p class="lead">
      Explore key events and policy changes that shaped Newport Harbor.  
      The interactive timeline comes first, followed by a date-sorted list you can vertically swipe through.
    </p>

    <div class="section-divider"></div>

    <!--
      â­ INTERACTIVE TIMELINE
      KnightLab embed stays here. If I change the Google Sheet behind it,
      I just swap the "source=..." value below.
    -->
    <section class="timeline-frame" aria-label="Timeline embed">
      <header>
        <h2>Interactive timeline</h2>
        <p>Drag the bar left/right or use the arrows to move through time. Tap or click any event card for full details. Works well on phones and tablets too.</p>
      </header>
      <!-- IF I need a new KnightLab sheet, I replace the source param. Everything else can stay the same. -->
      <iframe src='https://cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=v2%3A2PACX-1vRa_n__SZZMkqV10J_cynmYBpDvdkwF10qG22TTjOHiQZqDUnEj945Khxcak10Kw_zgfDKqfkGGRETJ&font=Default&lang=en&initial_zoom=2&width=100%25&height=650' width='100%' height='650' webkitallowfullscreen mozallowfullscreen allowfullscreen frameborder='0'></iframe>
    </section>

    <div class="section-divider"></div>

    <!--
      CSV-DRIVEN LIST VIEW
      This is the vertical-swipe list version. It uses the KnightLab CSV but
      only pulls the pieces I care about for a quick scan.
    -->
    <section class="timeline-list-section">
      <h2 class="section-heading">Timeline Events (List View)</h2>
      <p class="section-lead">
        Sorted by date using the <strong>Year</strong>, <strong>Month</strong>, and <strong>Day</strong>.
      </p>

      <!-- Little nav for the scroll box -->
      <div class="scroll-nav">
        <button type="button" onclick="scrollBoxToTop('timelineListWrapper')">Back to beginning</button>
        <button type="button" onclick="scrollBoxToBottom('timelineListWrapper')">Jump to end</button>
      </div>

      <!-- Vertical swipe container so this list doesn't take over the whole page -->
      <div id="timelineListWrapper" class="scroll-box">
        <!-- Timeline cards get rendered into this UL -->
        <ul id="timelineList" class="timeline-list"></ul>
      </div>

      <!-- Fallback message for no data / errors -->
      <p id="timelineFallback" class="muted" style="display:none;">
        No timeline entries are available yet. Once the CSV is updated with Headline, Text, date fields, and Background links, this list will fill in automatically.
      </p>
    </section>

  </main>

  <!-- PapaParse for CSV parsing in the browser -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script>
    /*
      Timeline list logic:
      Reads the KnightLab CSV and builds a vertical list of cards.
      Iâ€™m using Year / Month / Day to sort so it lines up with the main timeline.
    */

    // ðŸ‘‰ This is the CSV feed from KnightLab / Google Sheets.
    // If I ever move the timeline data to a new sheet, I just swap this URL.
    const TIMELINE_CSV_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vRa_n__SZZMkqV10J_cynmYBpDvdkwF10qG22TTjOHiQZqDUnEj945Khxcak10Kw_zgfDKqfkGGRETJ/pub?output=csv";

    const timelineListEl = document.getElementById("timelineList");
    const timelineFallbackEl = document.getElementById("timelineFallback");

    // Same data in memory so I'm not re-parsing if I ever need to reuse it.
    let timelineRows = [];

    // Month names purely for making nicer human-readable dates.
    const MONTH_NAMES = [
      "January", "February", "March", "April", "May", "June",
      "July", "August", "September", "October", "November", "December"
    ];

    // Pull and parse the CSV.
    fetch(TIMELINE_CSV_URL)
      .then(response => response.text())
      .then(csvText => {
        const parsed = Papa.parse(csvText, { header: true });

        // Only keep rows that actually have a Headline, otherwise we get blank cards.
        timelineRows = (parsed.data || []).filter(row => row.Headline);

        renderTimelineList(timelineRows);
      })
      .catch(error => {
        console.error("Timeline CSV load error:", error);
        showFallbackMessage();
      });

    // Turn Year / Month / Day into a real Date object.
    function getRowDateObject(row) {
      const yearRaw = row["Year"];
      const monthRaw = row["Month"];
      const dayRaw = row["Day"];

      const year = parseInt(yearRaw, 10);
      if (isNaN(year)) {
        // If thereâ€™s no usable year, I treat it as undated.
        return null;
      }

      let month = parseInt(monthRaw, 10);
      if (isNaN(month) || month < 1 || month > 12) {
        month = 1;
      }

      let day = parseInt(dayRaw, 10);
      if (isNaN(day) || day < 1 || day > 31) {
        day = 1;
      }

      return new Date(year, month - 1, day);
    }

    // Format a Date as "December 15, 2011".
    function formatTimelineDate(dateObj) {
      if (!dateObj) return null;

      const year = dateObj.getFullYear();
      const monthName = MONTH_NAMES[dateObj.getMonth()];
      const day = dateObj.getDate();

      return `${monthName} ${day}, ${year}`;
    }

    // Sort rows by date and render them into cards.
    function renderTimelineList(rows) {
      if (!rows || rows.length === 0) {
        showFallbackMessage();
        return;
      }

      const wrapped = rows.map((row, index) => ({
        row,
        index,
        date: getRowDateObject(row),
      }));

      // Oldest first. If I ever want newest first I can reverse this.
      wrapped.sort((a, b) => {
        if (a.date && b.date) {
          return a.date - b.date;
        }
        if (a.date && !b.date) return -1;
        if (!a.date && b.date) return 1;
        return a.index - b.index;
      });

      timelineListEl.innerHTML = wrapped
        .map(item => renderTimelineCard(item.row, item.date))
        .join("");

      timelineFallbackEl.style.display = "none";
    }

    // Build a single card. This is where I wire up:
    // - date
    // - headline
    // - text
    // - optional link from the Link column
    function renderTimelineCard(row, dateObj) {
      const headline = row.Headline && row.Headline.trim()
        ? row.Headline.trim()
        : "Untitled event";

      const bodyText = row.Text && row.Text.trim()
        ? row.Text.trim()
        : "No description available yet.";

      const formattedDate = formatTimelineDate(dateObj);

      const dateLine = formattedDate
        ? `<p class="timeline-card-date">${formattedDate}</p>`
        : "";

      // ðŸ‘‰ Using the KnightLab "Background" column as a link source here.
      const rawLink = (row.Link || row.Link || "").trim();
      const linkHtml = rawLink
        ? `<p class="timeline-card-link"><a href="${rawLink}" target="_blank" rel="noopener noreferrer">Open related document or event</a></p>`
        : "";

      return `
        <li class="timeline-card">
          ${dateLine}
          <h3 class="timeline-card-title">${headline}</h3>
          <p class="timeline-card-text">${bodyText}</p>
          ${linkHtml}
        </li>
      `;
    }

    // Fallback: wipe list and show "nothing here yet".
    function showFallbackMessage() {
      timelineListEl.innerHTML = "";
      timelineFallbackEl.style.display = "block";
    }

    // Tiny helpers to scroll the vertical swipe box.
    function scrollBoxToTop(elementId) {
      const box = document.getElementById(elementId);
      if (box) box.scrollTop = 0;
    }

    function scrollBoxToBottom(elementId) {
      const box = document.getElementById(elementId);
      if (box) box.scrollTop = box.scrollHeight;
    }
  </script>
</body>
</html>
